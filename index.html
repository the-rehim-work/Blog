<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Spotify Now Playing</title>
<style>
  body { font-family: Arial; background: #121212; color: white; padding: 20px; }
  #track-info { display: flex; align-items: center; margin-top: 20px; display:none; }
  #track-info img { margin-right: 20px; border-radius:5px; }
  #log { background:#222; padding:10px; margin-top:20px; white-space:pre-wrap; max-height:300px; overflow-y:auto; }
  button { padding:10px 20px; background:#1db954; border:none; border-radius:5px; cursor:pointer; color:white; }
</style>
</head>
<body>

<h1>Spotify Now Playing</h1>
<button id="login-btn">Login with Spotify</button>

<div id="track-info">
  <img id="album-art" width="100" height="100">
  <div>
    <h2 id="track-name"></h2>
    <p id="artist-name"></p>
    <p id="album-name"></p>
    <p id="track-duration"></p>
    <div style="width:100%; background:#333; height:10px; border-radius:5px;">
      <div id="progress" style="height:100%; background:#1db954; width:0%; border-radius:5px;"></div>
    </div>
  </div>
</div>

<h2>Debug Log</h2>
<div id="log"></div>

<script>
const logDiv = document.getElementById("log");
function log(...args){ const msg=args.map(a=>typeof a==="object"?JSON.stringify(a,null,2):a).join(" "); logDiv.textContent+=msg+"\n"; console.log(msg); }

const clientId = "YOUR_CLIENT_ID"; // Spotify client ID
const redirectUri = "https://your-frontend.github.io/Blog/callback.html"; // will redirect to this page after login
const loginBtn = document.getElementById("login-btn");
const trackInfo = document.getElementById("track-info");

// Step 1: Redirect to our serverless backend to start login
loginBtn.addEventListener("click", ()=>{
  window.location.href=`https://your-backend.vercel.app/login`;
});

// Step 2: After callback, fetch currently playing from backend
async function fetchNowPlaying(){
  try{
    const resp = await fetch("https://your-backend.vercel.app/current");
    const data = await resp.json();
    log("Now Playing:", data);
    if(data && data.item){
      trackInfo.style.display="flex";
      document.getElementById("track-name").textContent = data.item.name;
      document.getElementById("artist-name").textContent = data.item.artists.map(a=>a.name).join(", ");
      document.getElementById("album-name").textContent = data.item.album.name;
      const dur = data.item.duration_ms;
      document.getElementById("track-duration").textContent = `${Math.floor(dur/60000)}:${String(Math.floor((dur%60000)/1000)).padStart(2,"0")}`;
      document.getElementById("album-art").src = data.item.album.images[0].url;
      document.getElementById("progress").style.width = `${(data.progress_ms/dur)*100}%`;
    } else {
      trackInfo.style.display="none";
      log("Nothing is playing");
    }
  }catch(e){ log("Error fetching track:", e); }
}

// Poll every 5 seconds
setInterval(fetchNowPlaying,5000);
fetchNowPlaying();
</script>

</body>
</html>
